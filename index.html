
<body>
<fieldset>
    <legend>Enter your data</legend>
    <form id="form">
        <label>First name:</label>
        <input id="first_name" class="user-data" placeholder="First name" type="text"/>
        <label>Last name:</label>
        <input id="last_name" class="user-data" placeholder="Last name" type="text"/>
        <label>Mobile:</label>
        <input id="phone_number" class="user-data" placeholder="123456789" pattern="[0-9]{3}[0-9]{3}[0-9]{3}" type="tel"/>
        <label>E-mail address:</label>
        <input id="email" class="user-data" placeholder="email@email.com" type ="email"/>
        <button id="add_button" type="submit">Add new contact</button>
    </form>
    <ul id="contacts"></ul>
    <button id="delete_selected">Delete selected</button>
</fieldset>
</body>

<style>

    body {
        background: lightgrey;
    }


    fieldset {
        padding-top: 20px;
        width: 80%;
    }

    legend {
        background: black;
        color: white;
        font-size: 20px;
        font-family: Lato, sans-serif;
        padding: 3px 6px;
        border-radius: 5px;
    }

    label {
        font-family: Lato, sans-serif;
        font-size: 13px;
        font-weight: bolder;
    }

    input:not(.checkbox) {
        display: block;
        margin-bottom: 10px;
        padding: 10px;
        border: 1px solid black;
        border-radius: 5px;
        height: 20px;
        text-align: center;
        width: 250px;
    }

    button {
        border: 1px solid lightslategrey;
        border-radius: 10px;
        background-color: lightslategrey;
        height: 30px;
        font-weight: bolder;
    }

    li {
        list-style-type: none;
    }

    .edit-fields {
        padding: 5px;
    }

    #delete_selected {
        width: 125px;
    }
     .edit-btn, .delete-btn, .save-btn {
        margin: 4px;
        height: 20px;
        width: 30px;
    }

</style>

<script>
var container = document.getElementById("contacts");
// var addContactButton = document.getElementById("add_button");
var firstNameInput = document.getElementById("first_name");
var lastNameInput = document.getElementById("last_name");
var phoneNumberInput = document.getElementById("phone_number");
var emailInput = document.getElementById("email");
var inputs = document.getElementsByClassName("user-data");
var form = document.getElementById("form");

updateContactList();
form.addEventListener("submit", validateData);

function addNewContact() {
    var contact = {
        firstName: firstNameInput.value,
        lastName: lastNameInput.value,
        phoneNumber: phoneNumberInput.value,
        email: emailInput.value
    };

    fetch("http://localhost:3000/contacts", {
        method: 'POST',
        body: JSON.stringify(contact),
        headers: {
            'Content-Type': 'application/json'
        }
    }).then(updateContactList);
    clearInputs();
}

function clearInputs() {
    var inputNode = Array.from(inputs);
    inputNode.forEach(function (input) {
        input.value = "";
    })
}

function deleteContact(contactId) {
    fetch("http://localhost:3000/contacts/" + contactId, {
        method:"DELETE",
        headers: {
            'Content-Type': 'application/json'
        }
    }).then(updateContactList)
}

function getContactList() {
    return fetch("http://localhost:3000/contacts")
        .then(function (response) {
            return response.json()
        }
    )
}

function displayContactList(contacts) {
    container.innerText = "";
    contacts.sort(function(a,b){
        return a.lastName.localeCompare(b.lastName);
    });

    contacts.forEach (function (contact) {
        var listNode = document.createElement("li");
        var checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.classList.add("checkbox");

        var editBtn = document.createElement("button");
            editBtn.classList.add("edit-btn");
            editBtn.innerHTML = '<i class="far fa-edit"></i>';
            editBtn.addEventListener("click", function () {
                var changedData = document.getElementsByClassName("edit-fields");


                var editNode = document.createElement("form");
                for (var i = 0; i < 4; i++) {
                    var editInputs = document.createElement("input");
                        editInputs.classList.add("edit-fields");

                    editNode.appendChild(editInputs);
                }

                listNode.appendChild(editNode);


                var changeNode = Array.from(changedData);
                    changeNode[0].placeholder = "First name";
                    changeNode[1].placeholder = "Last name";
                    changeNode[2].placeholder = "123456789";
                    changeNode[2].type = "tel";
                    changeNode[2].pattern = "[0-9]{3}[0-9]{3}[0-9]{3}";
                    changeNode[3].placeholder = "email@email.com";
                    changeNode[3].type = "email";

                var saveBtn = document.createElement("button");
                    saveBtn.classList.add("save-btn");

                editNode.appendChild(saveBtn);

                saveBtn.innerText = "Save";
                saveBtn.type = "submit";
                editNode.addEventListener("submit", validateChangedData);

                function validateChangedData() {
                    if (changeNode[0].value == "" || changeNode[1].value == "" || changeNode[2].value == "" || changeNode[3].value == "") {
                        alert ("All fields must be filled in!");
                        event.preventDefault();
                    }
                    else {
                        addNewData();
                    }
                }

                function addNewData() {
                    var updatedData = {
                        firstName: changeNode[0].value,
                        lastName: changeNode[1].value,
                        phoneNumber: changeNode[2].value,
                        email: changeNode[3].value
                    };

                    fetch("http://localhost:3000/contacts/" + contact.id, {
                        method: "PATCH",
                        body: JSON.stringify(updatedData),
                        headers: {
                            'Content-type': 'application/json'
                        }
                    }).then(updateContactList)
                };
            });

        var deleteBtn = document.createElement("button");
            deleteBtn.classList.add("delete-btn");
            deleteBtn.innerHTML = '<i class="far fa-trash-alt"></i>';
            deleteBtn.addEventListener("click", function () {
                deleteContact(contact.id)
            });

            listNode.innerHTML = "<b> Full name: </b>" + contact.firstName + " " + contact.lastName + ", <b>Mobile: </b>" + contact.phoneNumber + ", <b>E-mail: </b>" + contact.email;
            container.appendChild(listNode);
            listNode.appendChild(editBtn);
            listNode.appendChild(deleteBtn);
            listNode.prepend(checkbox);
    });
}

function updateContactList() {
    getContactList().then(displayContactList)
}

function validateData() {
    if (firstNameInput.value == "" || lastNameInput.value == "" || phoneNumberInput.value == "" || emailInput.value == "") {
        alert ("All fields must be filled in!");
        event.preventDefault();
    }
    else {
        addNewContact();
    }
}

</script>
<script defer src="https://use.fontawesome.com/releases/v5.1.1/js/all.js" integrity="sha384-BtvRZcyfv4r0x/phJt9Y9HhnN5ur1Z+kZbKVgzVBAlQZX4jvAuImlIz+bG7TS00a" crossorigin="anonymous"></script>



