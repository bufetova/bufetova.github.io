
<input id="first_name" class= "user-data" placeholder = "first name" />
<input id="last_name" class= "user-data" placeholder = "last name" />
<input id="phone_number" class= "user-data" placeholder = "phone number" />
<input id="email" class= "user-data" placeholder = "email" />
<button id="add_button">Add new contact</button>


<ul id="contacts"></ul>
<script>
var container = document.getElementById("contacts");
var addContactButton = document.getElementById("add_button");
var firstNameInput = document.getElementById("first_name");
var lastNameInput = document.getElementById("last_name");
var phoneNumberInput = document.getElementById("phone_number");
var emailInput = document.getElementById("email");
var inputs = document.getElementsByClassName("user-data");


updateContactList();
addContactButton.addEventListener("click", addNewContact);

function addNewContact() {
    var contact = {
        firstName: firstNameInput.value,
        lastName: lastNameInput.value,
        phoneNumber: phoneNumberInput.value,
        email: emailInput.value
    };

    fetch("http://localhost:3000/contacts", {
        method: 'POST',
        body: JSON.stringify(contact),
        headers: {
            'Content-Type': 'application/json'
        }
    }).then(updateContactList);
    clearInputs();
}

function clearInputs() {
    var inputNode = Array.from(inputs);
    inputNode.forEach(function (input) {
        input.value = "";
    })
}

function deleteContact(contactId) {
    fetch("http://localhost:3000/contacts/" + contactId, {
        method:"DELETE",
        headers: {
            'Content-Type': 'application/json'
        }
    }).then(updateContactList)
}

function getContactList() {
    return fetch("http://localhost:3000/contacts")
        .then(function (response) {
            return response.json()
        }
    )
}

function displayContactList(contacts) {
    container.innerText = "";
    contacts.forEach (function (contact) {
        var listNode = document.createElement("li");

        var editBtn = document.createElement("button");
            editBtn.innerText = "Edit";
            editBtn.addEventListener("click", function () {
                var changedData = document.getElementsByClassName("edit-fields");
                var editNode = document.createElement("div");
                for (var i = 0; i < 4; i++) {
                    var editInputs = document.createElement("input");
                        editInputs.classList.add("edit-fields");

                    editNode.appendChild(editInputs);
                }

                listNode.appendChild(editNode);

                var changeNode = Array.from(changedData);
                var saveBtn = document.createElement("button");

                editNode.appendChild(saveBtn);

                saveBtn.innerText = "Save";
                saveBtn.addEventListener("click", function () {
                    var updatedData = {
                        firstName: changeNode[0].value,
                        lastName: changeNode[1].value,
                        phoneNumber: changeNode[2].value,
                        email: changeNode[3].value
                    };

                    fetch("http://localhost:3000/contacts/" + contact.id, {
                        method: "PATCH",
                        body: JSON.stringify(updatedData),
                        headers: {
                            'Content-type': 'application/json'
                        }
                    }).then(updateContactList)
                });
            });



        var deleteBtn = document.createElement("button");
            deleteBtn.innerText = "Delete contact";
            deleteBtn.addEventListener("click", function () {
                deleteContact(contact.id)
            });

            listNode.innerText = contact.firstName + " " + contact.lastName + " " + contact.phoneNumber + " " + contact.email;
            container.appendChild(listNode);
            listNode.appendChild(editBtn);
            listNode.appendChild(deleteBtn);
    })
}

function updateContactList() {
    getContactList().then(displayContactList)
}

</script>